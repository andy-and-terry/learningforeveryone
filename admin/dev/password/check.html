<!DOCTYPE HTML>
<head>
	<meta charset="UTF-8">
	<title>Login test</title>
	<script>
		localStorage.clear();
    document.addEventListener('contextmenu', function(event) {
    event.preventDefault();
});
	</script>
</head>
<body>
	<body>

<h2>Login</h2>

<div>
  <label>
    Username:
    <input id="username" autocomplete="username">
  </label>
</div>

<div>
  <label>
    Password:
    <input id="password" type="password" autocomplete="current-password">
  </label>
</div>

<button id="loginBtn">Test</button>

<p id="status"></p>
<script>
async function hashPassword(password, saltBase64) {
  const salt = Uint8Array.from(atob(saltBase64), c => c.charCodeAt(0));

  const keyMaterial = await crypto.subtle.importKey(
    "raw",
    new TextEncoder().encode(password),
    "PBKDF2",
    false,
    ["deriveBits"]
  );

  const bits = await crypto.subtle.deriveBits(
    {
      name: "PBKDF2",
      hash: "SHA-256",
      salt: salt,
      iterations: 150000
    },
    keyMaterial,
    256
  );

  return btoa(String.fromCharCode(...new Uint8Array(bits)));
}

document.getElementById("loginBtn").onclick = async () => {
  const user = document.getElementById("username").value.trim();
  const pass = document.getElementById("password").value;

  const status = document.getElementById("status");
  status.textContent = "Checkingâ€¦";

  try {
    const res = await fetch("../../../login/users.json");
    const users = await res.json();

    const account = users.find(u => u.username === user);
    if (!account) {
      status.textContent = "User not found";
      return;
    }

    const hashed = await hashPassword(pass, account.salt);

    if (hashed === account.hash) {
      status.textContent = "Login OK";
    } else {
      status.textContent = "Wrong password";
    }

  } catch (e) {
    status.textContent = "Login error";
    console.error(e);
  }
};
</script>

</body>
